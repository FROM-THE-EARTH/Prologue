# 諸々の定義
## 座標系
　使用している座標系は2つ有ります。
  - 地上座標系：普通の座標です。x方向を東方向、y方向を北方向、z方向を鉛直上向きの方向としています。原点は打上点です。
  - 機体座標系：機体座標系の項で説明します。

## 方角の定義
  北を0度、東を90度とし、時計回りに方角を定義しています。

## 風
　風向が0度のとき、それは北から南へ吹く風で、ベクトルとしてはVector3D(-1, 0, 0)となります。風向が45度の場合はVector3D(-1, -1, 0)です。

## 機体座標系
  ![](body_coordinate.png)
  
  機体座標系の原点は**ロケットの重心**です。x方向は機体のノーズ方向、y,z軸は機体に垂直な方向です。y,z軸は対称なので実質同じみたいな感じです。

  また、回転方向は右ねじの法則です。

  プログラムにおいて、機体座標系を用いる変数には添字"**_b**"をつけています。

# クォータニオン
  機体の姿勢演算にはクォータニオンをゴリゴリ使ってます。以下のサイトが参考になりそうです。
  - [Qiita / Quaternionを総整理](https://qiita.com/drken/items/0639cf34cce14e8d58a5)
  - [Wikipedia / Conversion between quaternions and Euler angles](https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles)
  - [NASA / Euler Angles, Quaternions, and Transformation Matrices](https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19770024290.pdf)

  正直良くわかりませんが、とりあえず姿勢があってて軌道もそれっぽいのが出てる気がするのでいいかなという感じです。物理つよつよマンいたら計算があってるのか確認してみてください。

# シミュレーション
軌道、姿勢のシミュレーションは微分方程式で行っています。

プログラム見ると微分方程式っぽくないかもしれませんが微分方程式らしいです。指定したdelta_time毎のステップで各パラメータのdeltaを計算し、以前の状態に加算することでシミュレーションできているようです。

# 風モデル
　独自開発した風モデルについてです。定義は以下の通りです。

- 大気を高度別に4つの層に分けて計算する.
- 磁気偏角は地図を回転することで考慮するため,ここでは考慮せずに計算する.
- 角度は真北を0度,時計回りとする.
- 地衡風速を15m/sとする.

|名称|高度|計算方法|
|:-----------|:------|:------|
|地上|0m以下|指定した地上風を与える|
|接地層|300m未満|1. 地上風の風向を1000mで90度方向に吹くように回転させる.<br>2. 地上風の風速に係数を6.0としたべき風速を適用する.|
|エクマン層|1000m未満|1. 地上風の風向を1000mで90度方向に吹くように回転させる.<br>2. 地上風の風速に係数を7.0としたべき風速を適用する.<br>3. 2の計算結果に対し,1000ｍで影響が無くなるように徐々に減衰させる.<br>4. 参考文献に従い,エクマン層における風を計算する.<br>5. 3と4の結果を足し合わせたものをその高度における風とする.|
|自由大気|1000m以上|地衡風速, 90度方向への風(西風)を与える.|

- [参考文献](http://kishou.u-gakugei.ac.jp/graduate/local/doc04.pdf)